<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="初步了解什么是 GORM？GORM 是 Go 语言中最流行的 ORM（对象关系映射）库之一，可以通过 Go 代码与数据库交互，避免直接编写复杂的 SQL。它的功能包括：  自动建表 基本 CRUD（增删改查） 关联关系（如一对多、多对多） 事务处理 数据迁移等  安装 GORM 和驱动 初始化 Go 模块（如果项目未初始化）： 1go mod init gorm-demo    安装 GORM 和">
<meta property="og:type" content="article">
<meta property="og:title" content="建立一个项目2_GORM入门">
<meta property="og:url" content="https://shanjhs.github.io/2024/11/23/%E5%BB%BA%E7%AB%8B%E4%B8%80%E4%B8%AA%E9%A1%B9%E7%9B%AE2-GORM%E5%85%A5%E9%97%A8/index.html">
<meta property="og:site_name" content="山角函兽的小窝">
<meta property="og:description" content="初步了解什么是 GORM？GORM 是 Go 语言中最流行的 ORM（对象关系映射）库之一，可以通过 Go 代码与数据库交互，避免直接编写复杂的 SQL。它的功能包括：  自动建表 基本 CRUD（增删改查） 关联关系（如一对多、多对多） 事务处理 数据迁移等  安装 GORM 和驱动 初始化 Go 模块（如果项目未初始化）： 1go mod init gorm-demo    安装 GORM 和">
<meta property="og:locale">
<meta property="article:published_time" content="2024-11-23T07:40:59.000Z">
<meta property="article:modified_time" content="2024-11-23T07:40:59.361Z">
<meta property="article:author" content="山角函兽">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://ShanJHS.github.io/2024/11/23/建立一个项目2-GORM入门/"/>





  <title>建立一个项目2_GORM入门 | 山角函兽的小窝</title>
  








<meta name="generator" content="Hexo 7.3.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">山角函兽的小窝</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://ShanJHS.github.io/2024/11/23/%E5%BB%BA%E7%AB%8B%E4%B8%80%E4%B8%AA%E9%A1%B9%E7%9B%AE2-GORM%E5%85%A5%E9%97%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/headImage.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="山角函兽的小窝">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">建立一个项目2_GORM入门</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2024-11-23T15:40:59+08:00">
                2024-11-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h3 id="初步了解"><a href="#初步了解" class="headerlink" title="初步了解"></a>初步了解</h3><h4 id="什么是-GORM？"><a href="#什么是-GORM？" class="headerlink" title="什么是 GORM？"></a>什么是 GORM？</h4><p>GORM 是 Go 语言中最流行的 ORM（对象关系映射）库之一，可以通过 Go 代码与数据库交互，避免直接编写复杂的 SQL。它的功能包括：</p>
<ul>
<li>自动建表</li>
<li>基本 CRUD（增删改查）</li>
<li>关联关系（如一对多、多对多）</li>
<li>事务处理</li>
<li>数据迁移等</li>
</ul>
<h4 id="安装-GORM-和驱动"><a href="#安装-GORM-和驱动" class="headerlink" title="安装 GORM 和驱动"></a>安装 GORM 和驱动</h4><ol>
<li><p><strong>初始化 Go 模块</strong>（如果项目未初始化）：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">go</span> mod init gorm-demo</span><br></pre></td></tr></table></figure>


</li>
<li><p><strong>安装 GORM 和数据库驱动</strong>： 以 MySQL 为例，安装 GORM 和 MySQL 驱动：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">go</span> get -u gorm.io/gorm</span><br><span class="line"><span class="keyword">go</span> get -u gorm.io/driver/mysql</span><br></pre></td></tr></table></figure>


</li>
<li><p><strong>导入包</strong>： 在代码中导入：</p>
</li>
</ol>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;gorm.io/driver/mysql&quot;</span></span><br><span class="line">    <span class="string">&quot;gorm.io/gorm&quot;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>



<h3 id="连接数据库"><a href="#连接数据库" class="headerlink" title="连接数据库"></a>连接数据库</h3><p><strong>配置数据库连接实例</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    dsn := <span class="string">&quot;user:password@tcp(127.0.0.1:3306)/dbname?charset=utf8mb4&amp;parseTime=True&amp;loc=Local&quot;</span></span><br><span class="line">    db, err := gorm.Open(mysql.Open(dsn), &amp;gorm.Config&#123;&#125;)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;Failed to connect to database:&quot;</span>, err)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fmt.Println(<span class="string">&quot;Database connected!&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>解析</strong></p>
<h4 id="dsn"><a href="#dsn" class="headerlink" title="dsn"></a><code>dsn</code></h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username:password@tcp(host:port)/dbname?param1=value1&amp;param2=value2</span><br></pre></td></tr></table></figure>

<p>是 <strong>Data Source Name</strong> 的缩写，它是一个字符串，用于定义连接数据库所需的信息。<code>DSN</code> 通常包含以下内容：</p>
<ul>
<li>数据库用户名</li>
<li>数据库密码</li>
<li>数据库地址（主机名&#x2F;IP 和端口）</li>
<li>数据库名称(如果要建立新数据库则不用连接)</li>
<li>额外的参数（例如字符集、时区设置等，非必需）</li>
</ul>
<p><strong>过程：</strong>使用主机名&#x2F;IP和端口连接至特定服务器上的特定数据库，然后使用数据库用户名和密码访问特定数据库（必需过程），再访问特定的库，最后通过额外的参数来限制访问数据库过程中的基础设置</p>
<p><strong>常见参数</strong>（数据库和代码的配置环境可能不同，通过显式指定，减少意外错误）有：</p>
<ul>
<li><code>charest=utf8mb4</code>设置数据库连接的字符集为<code>utf8mb4</code>（UTF-8的扩展，支持更多字符）</li>
<li><code>parseTime=True</code>启用时间解析将MySQL的<code>DATETIME</code>和<code>timestamp</code>解析为Go的<code>time.Time</code>类，否则其返回的时间类型将以字符串形式处理</li>
<li><code>loc=local</code>指定数据库连接使用的时区为本地时区，避免时区差异导致的时间偏移问题</li>
</ul>
<h4 id="gorm-open"><a href="#gorm-open" class="headerlink" title="gorm.open()"></a><code>gorm.open()</code></h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db, err := gorm.Open(mysql.Open(dsn), &amp;gorm.Config&#123;&#125;)</span><br></pre></td></tr></table></figure>

<p>GORM 框架 提供的一个函数，用于初始化数据库连接。</p>
<p>主要作用是：</p>
<ol>
<li><strong>连接数据库</strong>：根据提供的数据库驱动和 DSN（Data Source Name），创建数据库连接。</li>
<li><strong>返回一个 <code>*gorm.DB</code> 实例</strong>：该实例是数据库操作的核心对象，后续的查询、插入、更新、删除等操作都通过它完成。</li>
</ol>
<p><strong>函数签名</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Open</span><span class="params">(dialector gorm.Dialector, opts ...gorm.Option)</span></span> (*gorm.DB, <span class="type">error</span>)</span><br></pre></td></tr></table></figure>

<p>参数：</p>
<p>**<code>dialector</code>**：</p>
<p>表示数据库驱动程序，例如 MySQL、PostgreSQL、SQLite 等。需要通过 <code>gorm.io/driver/&lt;driver&gt;</code> 提供的函数构建。（支持多种数据库，使用时更换<code>dialector</code>即可）</p>
<p>例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql.Open(dsn)       // MySQL</span><br><span class="line">sqlite.Open(filepath) // SQLite</span><br></pre></td></tr></table></figure>

<p>**<code>opts ...gorm.Option</code>**：</p>
<p>可选参数，用于设置 GORM 的额外配置。</p>
<p>例如，日志配置、连接池设置等。</p>
<p>比如此处传递的<code>gorm.Config&#123;&#125;</code>是GORM框架给定的一个专门用于调整GORM行为的结构体（在结构体中作更改），而非核心对象，所以可以直接写<code>nil</code>也无妨，GORM将使用默认配置</p>
<h3 id="库、表层操作"><a href="#库、表层操作" class="headerlink" title="库、表层操作"></a>库、表层操作</h3><h4 id="建立一个新的数据库"><a href="#建立一个新的数据库" class="headerlink" title="建立一个新的数据库"></a>建立一个新的数据库</h4><p>首先开始时不必连接数据库</p>
<p>GORM没有专门函数来创建数据库，但GORM提供直接以SQL语言编写程序的函数<code>db.Exec()</code>方法</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">err = db.Exec(<span class="string">&quot;CREATE DATABASE IF NOT EXISTS newdb&quot;</span>).Error</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;Failed to create database:&quot;</span>, err)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;Database &#x27;newdb&#x27; created successfully!&quot;</span>)</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h4 id="建立新的数据表"><a href="#建立新的数据表" class="headerlink" title="建立新的数据表"></a>建立新的数据表</h4><p>GORM通过结构体来映射数据表</p>
<p>定义一个结构体</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">	ID   <span class="type">uint</span> <span class="string">`gorm:&quot;primaryKey;autoIncrement&quot;`</span> <span class="comment">// 设置为主键且自增</span></span><br><span class="line">	Name <span class="type">string</span> <span class="string">`gorm:&quot;type:varchar(100);not null&quot;`</span> </span><br><span class="line">	Age  <span class="type">int</span> <span class="string">`gorm:&quot;default:18&quot;`</span> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如其中所示，数据库字段的约束（如 <code>NOT NULL</code>, <code>DEFAULT</code> 等）可以通过 GORM 的结构体标签来指定。</p>
<p>如果string类型后面没有使用SQL语法特别指定存储字长，则会是默认的</p>
<p>通过 <code>AutoMigrate()</code> 方法，GORM 会自动检查结构体与数据库表之间的差异，并执行必要的操作来创建或更新表结构：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 自动迁移：根据 User 结构体创建表</span></span><br><span class="line">	err = db.AutoMigrate(&amp;User&#123;&#125;)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;Failed to migrate table:&quot;</span>, err)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;Table &#x27;users&#x27; created successfully!&quot;</span>)</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p>在执行 <code>db.Create(&amp;user)</code> 时，GORM 会：</p>
<ol>
<li>识别 <code>user</code> 是 <code>User</code> 结构体类型。</li>
<li>根据结构体的字段将数据插入到对应的表（默认是 <code>users</code> 表，除非你定制了表名）。</li>
<li>插入操作会根据结构体的字段（如 <code>Name</code>, <code>Age</code>, <code>Email</code>）向表中插入数据。</li>
</ol>
<p>此时这个表会根据结构体<code>User</code>的名字将表命名为<code>users</code>（每个结构体对应唯一的一张表），其中包含 <code>ID</code>, <code>Name</code>, 和 <code>Age</code> 字段。如果需要<strong>更改默认的表名</strong>，可以通过结构体标签来定制：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 修改表名为 custom_users</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(User)</span></span> TableName() <span class="type">string</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;custom_users&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个函数表示TableName()是结构体<code>User</code>的方法，可以放在定义了<code>User</code>结构体后就定义这个方法，GORM会在内部自动调用它，每次需要根据结构体映射到具体的表时都会调用（比如新建一张表，在表里新建或更新元素）以覆盖原本默认的命名规则</p>
<p>在 <code>AutoMigrate</code> 中，传递结构体的<strong>地址</strong>（如 <code>&amp;User&#123;&#125;</code>）是因为 GORM 需要获取结构体的元数据来推断表的结构，而无需实例化。</p>
<h4 id="切换数据库进行操作"><a href="#切换数据库进行操作" class="headerlink" title="切换数据库进行操作"></a>切换数据库进行操作</h4><p>只需更改（重新设置一个)DSN并重新调用<code>gorm.Open()</code>函数来获取新的数据库连接，比如：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">dsn1 := <span class="string">&quot;root:password@tcp(127.0.0.1:3306)/newdb?charset=utf8mb4&amp;parseTime=True&amp;loc=Local&quot;</span></span><br><span class="line">	db1, err := gorm.Open(mysql.Open(dsn1), &amp;gorm.Config&#123;&#125;)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;Failed to connect to newdb:&quot;</span>, err)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(<span class="string">&quot;Connected to newdb successfully!&quot;</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 在第一个数据库中操作</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// 连接到第二个数据库</span></span><br><span class="line">	dsn2 := <span class="string">&quot;root:password@tcp(127.0.0.1:3306)/anotherdb?charset=utf8mb4&amp;parseTime=True&amp;loc=Local&quot;</span></span><br><span class="line">	db2, err := gorm.Open(mysql.Open(dsn2), &amp;gorm.Config&#123;&#125;)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;Failed to connect to anotherdb:&quot;</span>, err)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(<span class="string">&quot;Connected to anotherdb successfully!&quot;</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 在第二个数据库中操作</span></span><br></pre></td></tr></table></figure>





<h3 id="Exec与Raw"><a href="#Exec与Raw" class="headerlink" title="Exec与Raw"></a>Exec与Raw</h3><h4 id="Exec函数"><a href="#Exec函数" class="headerlink" title="Exec函数"></a>Exec函数</h4><p><code>Exec</code> 是 GORM 中用来执行原生 SQL 语句的方法。它接受一个 SQL 查询字符串和可选的参数，用于执行不返回结果集的 SQL 语句（例如 <code>INSERT</code>, <code>UPDATE</code>, <code>DELETE</code> 或数据库管理操作如 <code>CREATE DATABASE</code>）</p>
<p>基本用法：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.Exec(<span class="string">&quot;SQL语句&quot;</span>, 参数...)</span><br></pre></td></tr></table></figure>

<p><strong>参数说明：</strong></p>
<p><strong>SQL语句</strong>：</p>
<ul>
<li>第一个参数是你想要执行的 SQL 语句，通常是一个字符串。</li>
<li>例如：<code>&quot;CREATE DATABASE IF NOT EXISTS newdb&quot;</code>。</li>
<li>SQL 语句中的参数可以是占位符（如 <code>?</code>）或命名参数（如 <code>:name</code>）。</li>
</ul>
<p><strong>参数</strong>：</p>
<ul>
<li>你可以在 SQL 语句中使用占位符（例如 <code>?</code>）或命名参数（例如 <code>:name</code>）。</li>
<li>第二个参数及其之后的所有参数将作为替代占位符的值传递。</li>
<li>这些参数通常是用来动态传递值的，可以防止 SQL 注入。</li>
</ul>
<p>占位符：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.Exec(<span class="string">&quot;UPDATE users SET name = ? WHERE id = ?&quot;</span>, <span class="string">&quot;Alice&quot;</span>, <span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<p>命名参数：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">db.Exec(<span class="string">&quot;INSERT INTO users (name, age) VALUES (:name, :age)&quot;</span>, </span><br><span class="line">        <span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">interface</span>&#123;&#125;&#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;Bob&quot;</span>, <span class="string">&quot;age&quot;</span>: <span class="number">30</span>&#125;)</span><br></pre></td></tr></table></figure>

<p>命名参数（如 <code>:name</code> 和 <code>:age</code>）并不是 Go 语言的原生语法，而是 GORM 特有的 SQL 参数绑定方式。这种方式是 GORM 提供的，用于在执行 SQL 语句时通过命名参数绑定值。</p>
<p>这种方式通常需要通过一个 <code>map</code> 或结构体传递参数。</p>
<p><strong>返回值</strong></p>
<p><code>Exec</code> 返回一个 <code>*gorm.DB</code> 对象，允许链式调用其他方法。</p>
<h4 id="Raw函数"><a href="#Raw函数" class="headerlink" title="Raw函数"></a>Raw函数</h4><p><code>Raw</code> 用于执行<strong>原生查询语句</strong>（<code>SELECT</code> 类型的 SQL），并将查询结果映射到目标变量中。</p>
<p><strong>特点：</strong></p>
<ul>
<li>主要用于<strong>读取数据</strong>。</li>
<li>与 GORM 的高级查询不同，<code>Raw</code> 直接接受原始 SQL 查询，适合复杂的查询操作。</li>
<li>必须与 <code>.Scan()</code> 或 <code>.Find()</code> 等方法结合使用，用于将查询结果映射到结构体或切片。</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> users []User</span><br><span class="line">db.Raw(<span class="string">&quot;SELECT * FROM users WHERE age &gt;= ?&quot;</span>, <span class="number">18</span>).Scan(&amp;users)</span><br></pre></td></tr></table></figure>

<p><code>.Scan()</code>和<code>.Find()</code>使用区别后文详述</p>
<p>一般查询优先使用GORM提供的链式方法如<code>Where</code>、<code>Find</code></p>
<h3 id="CRUD功能"><a href="#CRUD功能" class="headerlink" title="CRUD功能"></a>CRUD功能</h3><h4 id="1、创建-Create"><a href="#1、创建-Create" class="headerlink" title="1、创建(Create)"></a>1、创建(Create)</h4><p>通过 GORM 的 <code>Create</code> 方法可以向数据库插入一条记录。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建一个新的用户</span></span><br><span class="line">user := User&#123;Name: <span class="string">&quot;Alice&quot;</span>, Age: <span class="number">30</span>, Email: <span class="string">&quot;alice@example.com&quot;</span>&#125;</span><br><span class="line">result := db.Create(&amp;user)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> result.Error != <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;Error creating user:&quot;</span>, result.Error)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;User created:&quot;</span>, user)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>把要插入的元素实例化 –&gt; 使用<code>Create</code>插入（此处一定要传入地址，方便GORM对该实例进行修改）</p>
<p><strong>传地址：</strong><code>db.Create()</code> 方法会自动为传入的结构体填充数据库生成的字段值（是直接在被取址的实例中填充后再入库），例如自增的主键 ID、时间戳等。如果不传入地址，GORM 无法直接修改这些字段。这样方便立刻使用数据库生成的值</p>
<p>GORM 的所有操作（如 <code>Create</code>, <code>Save</code>, <code>Find</code> 等）默认要求<strong>使用结构体的地址</strong>，保持一致性。</p>
<h4 id="2、读取-Read"><a href="#2、读取-Read" class="headerlink" title="2、读取(Read)"></a>2、读取(Read)</h4><h5 id="First和Find"><a href="#First和Find" class="headerlink" title="First和Find"></a><code>First</code>和<code>Find</code></h5><p>两种常用的查询方法，它们的主要区别在于查询结果的数量、顺序处理，以及在数据不存在时的行为</p>
<p><strong><code>First:</code></strong></p>
<p>用于查询符合条件的第一条记录</p>
<p>如果没有记录，会返回 <code>gorm.ErrRecordNotFound</code> 错误</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> user User</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查询第一条记录（按主键升序）</span></span><br><span class="line">db.First(&amp;user) <span class="comment">// SELECT * FROM users ORDER BY id LIMIT 1;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 按条件查询第一条记录</span></span><br><span class="line">db.Where(<span class="string">&quot;name = ?&quot;</span>, <span class="string">&quot;Alice&quot;</span>).First(&amp;user) <span class="comment">// SELECT * FROM users WHERE name = &quot;Alice&quot; ORDER BY id LIMIT 1;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 如果没有记录</span></span><br><span class="line">result := db.First(&amp;user, <span class="number">100</span>) <span class="comment">// 查询主键为 100 的记录</span></span><br><span class="line"><span class="keyword">if</span> errors.Is(result.Error, gorm.ErrRecordNotFound) &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;记录不存在&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><code>Find</code></strong></p>
<p>用于查询所有符合条件的记录</p>
<p>如果没有记录，不会返回错误，而是返回空切片或零值。（此处的返回指填充传入实例）</p>
<p>即使目标是一个单一结构体（非切片），<code>Find</code> 仍会运行查询。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> users []User</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查询所有记录</span></span><br><span class="line">db.Find(&amp;users) <span class="comment">// SELECT * FROM users;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 按条件查询多条记录</span></span><br><span class="line">db.Where(<span class="string">&quot;age &gt; ?&quot;</span>, <span class="number">18</span>).Find(&amp;users) <span class="comment">// SELECT * FROM users WHERE age &gt; 18;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 即使没有记录</span></span><br><span class="line">db.Where(<span class="string">&quot;age &gt; ?&quot;</span>, <span class="number">100</span>).Find(&amp;users) <span class="comment">// 不报错，返回空切片</span></span><br><span class="line">fmt.Println(<span class="built_in">len</span>(users)) <span class="comment">// 0</span></span><br></pre></td></tr></table></figure>

<h5 id="Find填充结构体切片的方法"><a href="#Find填充结构体切片的方法" class="headerlink" title="Find填充结构体切片的方法"></a><code>Find</code>填充结构体切片的方法</h5><p><strong>SQL 执行</strong><br>GORM 会根据你的查询条件生成对应的 SQL 语句，并执行查询。</p>
<p><strong>结果映射</strong><br>查询返回的每一条记录会按照 <code>User</code> 结构体的字段映射填充。字段名与数据库列名需一致或通过 GORM 标签匹配。</p>
<p><strong>填充切片</strong><br>GORM 动态扩展传入切片的容量，并将每个映射完成的结构体实例依次填充到切片中。</p>
<h5 id="常见读取操作"><a href="#常见读取操作" class="headerlink" title="常见读取操作"></a>常见读取操作</h5><p><strong>基本查询</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 查询第一条记录</span></span><br><span class="line"><span class="keyword">var</span> user User</span><br><span class="line">result := db.First(&amp;user) <span class="comment">// SELECT * FROM users ORDER BY id LIMIT 1;</span></span><br><span class="line">fmt.Println(user)         <span class="comment">// 输出第一条记录</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 查询所有记录</span></span><br><span class="line"><span class="keyword">var</span> users []User</span><br><span class="line">result = db.Find(&amp;users)  <span class="comment">// SELECT * FROM users;</span></span><br><span class="line">fmt.Println(users)        <span class="comment">// 输出所有记录</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 结果的影响条数</span></span><br><span class="line">fmt.Println(result.RowsAffected) <span class="comment">// 查询到的记录数</span></span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 按主键查询</span></span><br><span class="line"><span class="keyword">var</span> user User</span><br><span class="line">db.First(&amp;user, <span class="number">1</span>) <span class="comment">// SELECT * FROM users WHERE id = 1;</span></span><br></pre></td></tr></table></figure>

<p><strong>查询条件</strong></p>
<p>**where:**支持多种格式查询</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//单个条件</span></span><br><span class="line"><span class="keyword">var</span> user User</span><br><span class="line">db.Where(<span class="string">&quot;name = ?&quot;</span>, <span class="string">&quot;Alice&quot;</span>).First(&amp;user) </span><br><span class="line"></span><br><span class="line"><span class="comment">//多个条件</span></span><br><span class="line"><span class="keyword">var</span> users []User</span><br><span class="line">db.Where(<span class="string">&quot;name = ? AND age &gt;= ?&quot;</span>, <span class="string">&quot;Alice&quot;</span>, <span class="number">18</span>).Find(&amp;users) </span><br><span class="line"></span><br><span class="line"><span class="comment">//条件为结构体</span></span><br><span class="line"><span class="keyword">var</span> user User</span><br><span class="line">db.Where(&amp;User&#123;Name: <span class="string">&quot;Alice&quot;</span>, Age: <span class="number">18</span>&#125;).First(&amp;user) </span><br><span class="line"></span><br><span class="line"><span class="comment">//条件为map</span></span><br><span class="line"><span class="keyword">var</span> users []User</span><br><span class="line">db.Where(<span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">interface</span>&#123;&#125;&#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;Alice&quot;</span>, <span class="string">&quot;age&quot;</span>: <span class="number">18</span>&#125;).Find(&amp;users)</span><br></pre></td></tr></table></figure>

<p>**Raw:**执行原生SQL查询</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> users []User</span><br><span class="line">db.Raw(<span class="string">&quot;SELECT * FROM users WHERE age &gt;= ?&quot;</span>, <span class="number">18</span>).Scan(&amp;users)</span><br></pre></td></tr></table></figure>

<p>Raw后面用于读取的一般是<code>Find()</code>或<code>Scan()</code></p>
<p>两者的区别是：</p>
<p><code>Scan</code> （更加灵活）仅负责将查询结果填充到指定的目标变量中，不依赖 GORM 模型的定义。它的目标可以是非 GORM 模型的结构体、切片（如 <code>[]struct</code>）、基础类型（如 <code>int</code>、<code>string</code>）</p>
<p><code>Find</code> （适用于简单查询或需要模型功能时）依赖于 GORM 的模型定义，目标变量必须是与数据库表结构一致的模型或模型的切片。可自动处理表名映射、字段名映射，可触发 GORM 的关联功能（如自动加载 <code>hasOne</code> 或 <code>hasMany</code> 的关联表数据）</p>
<p>**Select:**查询部分字段</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> users []User</span><br><span class="line">db.Select(<span class="string">&quot;name, age&quot;</span>).Find(&amp;users) </span><br></pre></td></tr></table></figure>

<p>**Like:**模糊查询</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> users []User</span><br><span class="line">db.Where(<span class="string">&quot;name LIKE ?&quot;</span>, <span class="string">&quot;%Ali%&quot;</span>).Fid(&amp;users) </span><br></pre></td></tr></table></figure>

<h5 id="处理查询结果"><a href="#处理查询结果" class="headerlink" title="处理查询结果"></a>处理查询结果</h5><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">result := db.First(&amp;user)</span><br><span class="line"><span class="comment">//检查是否存在记录</span></span><br><span class="line"><span class="keyword">if</span> errors.Is(result.Error, gorm.ErrRecordNotFound) &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;Record not found!&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//获取查询影响的条数</span></span><br><span class="line">fmt.Println(result.RowsAffected) </span><br><span class="line"><span class="comment">//获取错误</span></span><br><span class="line"><span class="keyword">if</span> result.Error != <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;Error:&quot;</span>, result.Error)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行查询时，返回的 <code>result</code> 是一个 <strong><code>*gorm.DB</code> 类型的实例</strong>。它包含了查询操作的详细信息和状态</p>
<p><code>*gorm.DB</code> 是 GORM 提供的一个核心结构体，它不仅用于执行数据库操作，还用来存储每次操作的元信息。</p>
<p><strong>主要字段和方法</strong></p>
<ul>
<li><strong><code>Error</code></strong>: 存储执行操作时遇到的错误（如果有）。</li>
<li><strong><code>RowsAffected</code></strong>: 存储执行操作后影响的行数。</li>
<li><strong><code>Statement</code></strong>: 保存当前 SQL 语句的详细信息。</li>
<li><strong>链式调用</strong>：可以继续执行其他方法（如 <code>Where</code>、<code>Find</code> 等）。</li>
</ul>
<p>此时的<code>result</code>和之前使用<code>gorm.Open()</code>打开的<code>*gorm.DB</code>不一样，它包含了创建这个实例的上下文（包括SQL语句、查询条件等等），所以如果对它再次查询则会基于原本的条件上面</p>
<h4 id="3、更新-Update"><a href="#3、更新-Update" class="headerlink" title="3、更新(Update)"></a>3、更新(Update)</h4><h5 id="Save-单记录更新"><a href="#Save-单记录更新" class="headerlink" title="Save:单记录更新"></a>Save:单记录更新</h5><p>将传入的模型视为一个完整的新状态，一条记录的所有字段都会被更新（包括零值字段，如 <code>0</code>、<code>&quot;&quot;</code>、<code>false</code>）。</p>
<p>必须确保模型的主键（<code>ID</code> 或自定义主键字段）已经设置，否则会当作插入新记录处理。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">    ID   <span class="type">uint</span></span><br><span class="line">    Name <span class="type">string</span></span><br><span class="line">    Age  <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> user User</span><br><span class="line">db.First(&amp;user, <span class="number">1</span>) <span class="comment">// 获取 ID 为 1 的记录</span></span><br><span class="line"></span><br><span class="line">user.Name = <span class="string">&quot;Updated Name&quot;</span></span><br><span class="line">user.Age = <span class="number">30</span></span><br><span class="line"></span><br><span class="line">db.Save(&amp;user) <span class="comment">// 更新整条记录</span></span><br></pre></td></tr></table></figure>

<h5 id="Update-单字段更新"><a href="#Update-单字段更新" class="headerlink" title="Update:单字段更新"></a>Update:单字段更新</h5><p>更新一条记录的单个字段，非条件情况下需要通过主键指定目标记录。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">db.Model(&amp;User&#123;&#125;).Where(<span class="string">&quot;id = ?&quot;</span>, <span class="number">1</span>).Update(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;New Name&quot;</span>)</span><br><span class="line"><span class="comment">// 执行的 SQL：UPDATE users SET name = &#x27;New Name&#x27; WHERE id = 1</span></span><br></pre></td></tr></table></figure>

<p>条件更新：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">db.Model(&amp;User&#123;&#125;).Where(<span class="string">&quot;age &gt; ?&quot;</span>, <span class="number">18</span>).Update(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;Adult&quot;</span>)</span><br><span class="line"><span class="comment">// 执行的 SQL：UPDATE users SET name = &#x27;Adult&#x27; WHERE age &gt; 18</span></span><br></pre></td></tr></table></figure>

<h5 id="Updates-多字段更新"><a href="#Updates-多字段更新" class="headerlink" title="Updates:多字段更新"></a>Updates:多字段更新</h5><p>可通过结构体或 <code>map</code> 更新多个字段。</p>
<h5 id="使用结构体更新："><a href="#使用结构体更新：" class="headerlink" title="使用结构体更新："></a>使用结构体更新：</h5><ul>
<li>默认忽略零值字段（即不会更新为结构体字段值为 <code>0</code>、<code>&quot;&quot;</code>、<code>false</code> 等,为了防止零值覆盖的操作）</li>
<li>可以通过 <code>Select</code> 或 <code>Omit</code> 指定更新的字段</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">db.Model(&amp;User&#123;&#125;).Where(<span class="string">&quot;id = ?&quot;</span>, <span class="number">1</span>).Updates(User&#123;Name: <span class="string">&quot;New Name&quot;</span>, Age: <span class="number">0</span>&#125;)</span><br><span class="line"><span class="comment">// 执行的 SQL：UPDATE users SET name = &#x27;New Name&#x27; WHERE id = 1，而Age由于为0不会更新</span></span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">db.Model(&amp;User&#123;&#125;).Where(<span class="string">&quot;id = ?&quot;</span>, <span class="number">1</span>).Select(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;age&quot;</span>).Updates(User&#123;Name: <span class="string">&quot;Alice&quot;</span>, Age: <span class="number">28</span>, City: <span class="string">&quot;New York&quot;</span>&#125;)</span><br><span class="line"><span class="comment">//select用来仅更新某些字段,此处city将不被更新即使传参</span></span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">db.Model(&amp;User&#123;&#125;).Where(<span class="string">&quot;id = ?&quot;</span>, <span class="number">1</span>).Omit(<span class="string">&quot;city&quot;</span>).Updates(User&#123;Name: <span class="string">&quot;Alice&quot;</span>, Age: <span class="number">28</span>, City: <span class="string">&quot;New York&quot;</span>&#125;)</span><br><span class="line"><span class="comment">//omit用来指定某些字段不被更新，此处city被排除即使传参</span></span><br></pre></td></tr></table></figure>

<h5 id="使用-map-更新："><a href="#使用-map-更新：" class="headerlink" title="使用 map 更新："></a>使用 <code>map</code> 更新：</h5><ul>
<li>不会忽略零值字段，所有字段都会被更新。</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">db.Model(&amp;User&#123;&#125;).Where(<span class="string">&quot;id = ?&quot;</span>, <span class="number">1</span>).Updates(<span class="keyword">map</span>[<span class="type">string</span>]<span class="keyword">interface</span>&#123;&#125;&#123;</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;New Name&quot;</span>,</span><br><span class="line">    <span class="string">&quot;age&quot;</span>:  <span class="number">0</span>,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 执行的 SQL：UPDATE users SET name = &#x27;New Name&#x27;, age = 0 WHERE id = 1</span></span><br></pre></td></tr></table></figure>

<p><strong>注意：</strong>使用<code>Save</code>时直接把结构体传参，根据主键寻找更新哪一条记录，而使用<code>Update(s)</code>时需要用<code>.Model()</code>来传入结构体地址以确认在哪张表里面搜索</p>
<h5 id="使用Exec原生SQL语句更新"><a href="#使用Exec原生SQL语句更新" class="headerlink" title="使用Exec原生SQL语句更新"></a>使用Exec原生SQL语句更新</h5><h4 id="4、删除-Delete"><a href="#4、删除-Delete" class="headerlink" title="4、删除(Delete)"></a>4、删除(Delete)</h4><h5 id="Delete方法"><a href="#Delete方法" class="headerlink" title="Delete方法"></a><code>Delete</code>方法</h5><p>删除记录通常用Delete方法，可以删除一条或多条</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">db.Where(<span class="string">&quot;id = ?&quot;</span>, <span class="number">1</span>).Delete(&amp;User&#123;&#125;)</span><br><span class="line"><span class="comment">//此处为删除一条，需要把映射结构体地址传参</span></span><br><span class="line"></span><br><span class="line">db.Where(<span class="string">&quot;age &lt; ?&quot;</span>, <span class="number">30</span>).Delete(&amp;User&#123;&#125;)</span><br><span class="line"><span class="comment">//删除多条</span></span><br><span class="line"></span><br><span class="line">db.Delete(&amp;User&#123;&#125;, <span class="number">1</span>)</span><br><span class="line"><span class="comment">//根据主键删除一条</span></span><br></pre></td></tr></table></figure>

<h5 id="软删除"><a href="#软删除" class="headerlink" title="软删除"></a>软删除</h5><p>如果只想删除某些字段，通常在 GORM 中可以使用软删除功能（即不会直接删除数据，而是标记为已删除）。这通常需要在模型中启用 <code>gorm.Model</code>(删除操作还是和普通删除一样)，它包含 <code>DeletedAt</code> 字段。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">    gorm.Model</span><br><span class="line">    Name <span class="type">string</span></span><br><span class="line">    Age  <span class="type">int</span></span><br><span class="line">    City <span class="type">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>通过 <code>gorm.Model</code>，<code>User</code> 模型包含了 <code>DeletedAt</code> 字段，表示软删除标记。</li>
</ul>
<p>通过软删除，记录不会被物理删除，而是更新 <code>DeletedAt</code> 字段为当前时间。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.Where(<span class="string">&quot;id = ?&quot;</span>, <span class="number">1</span>).Delete(&amp;User&#123;&#125;)</span><br></pre></td></tr></table></figure>

<p>该记录的 <code>DeletedAt</code> 字段将被设置为当前时间，而该记录将被认为已删除。</p>
<p><strong>恢复软删除记录</strong></p>
<p>如果希望恢复软删除的记录，可以使用 <code>Unscoped()</code> 方法</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.Unscoped().Where(<span class="string">&quot;id = ?&quot;</span>, <span class="number">1</span>).Delete(&amp;User&#123;&#125;)</span><br></pre></td></tr></table></figure>

<p><code>Unscoped()</code> 使 GORM 忽略软删除标记，允许物理删除记录。</p>
<p>默认情况下，GORM 会自动为启用了软删除的表（通过 <code>gorm.Model</code> 或自定义 <code>DeletedAt</code> 字段）在查询时<strong>排除已删除的记录</strong>。如果需要查询已删除的记录，可以使用 <code>Unscoped()</code> 方法。</p>

      
    </div>
    
    
    

    

    

    

<div>
  
    <div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div>
    
</div>

  
</div>

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2024/11/23/%E5%BB%BA%E7%AB%8B%E4%B8%80%E4%B8%AA%E9%A1%B9%E7%9B%AE1/" rel="next" title="建立一个项目（后端学习）1">
                <i class="fa fa-chevron-left"></i> 建立一个项目（后端学习）1
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2024/11/23/%E8%AE%A1%E7%BD%91%E5%9F%BA%E7%A1%801/" rel="prev" title="计网基础1">
                计网基础1 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/headImage.jpg"
                alt="" />
            
              <p class="site-author-name" itemprop="name"></p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/">
              
                  <span class="site-state-item-count">11</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">4</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">5</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/ShanJHS" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9D%E6%AD%A5%E4%BA%86%E8%A7%A3"><span class="nav-number">1.</span> <span class="nav-text">初步了解</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF-GORM%EF%BC%9F"><span class="nav-number">1.1.</span> <span class="nav-text">什么是 GORM？</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%89%E8%A3%85-GORM-%E5%92%8C%E9%A9%B1%E5%8A%A8"><span class="nav-number">1.2.</span> <span class="nav-text">安装 GORM 和驱动</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-number">2.</span> <span class="nav-text">连接数据库</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#dsn"><span class="nav-number">2.1.</span> <span class="nav-text">dsn</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#gorm-open"><span class="nav-number">2.2.</span> <span class="nav-text">gorm.open()</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BA%93%E3%80%81%E8%A1%A8%E5%B1%82%E6%93%8D%E4%BD%9C"><span class="nav-number">3.</span> <span class="nav-text">库、表层操作</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BB%BA%E7%AB%8B%E4%B8%80%E4%B8%AA%E6%96%B0%E7%9A%84%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-number">3.1.</span> <span class="nav-text">建立一个新的数据库</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BB%BA%E7%AB%8B%E6%96%B0%E7%9A%84%E6%95%B0%E6%8D%AE%E8%A1%A8"><span class="nav-number">3.2.</span> <span class="nav-text">建立新的数据表</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%87%E6%8D%A2%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9B%E8%A1%8C%E6%93%8D%E4%BD%9C"><span class="nav-number">3.3.</span> <span class="nav-text">切换数据库进行操作</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Exec%E4%B8%8ERaw"><span class="nav-number">4.</span> <span class="nav-text">Exec与Raw</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Exec%E5%87%BD%E6%95%B0"><span class="nav-number">4.1.</span> <span class="nav-text">Exec函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Raw%E5%87%BD%E6%95%B0"><span class="nav-number">4.2.</span> <span class="nav-text">Raw函数</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CRUD%E5%8A%9F%E8%83%BD"><span class="nav-number">5.</span> <span class="nav-text">CRUD功能</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1%E3%80%81%E5%88%9B%E5%BB%BA-Create"><span class="nav-number">5.1.</span> <span class="nav-text">1、创建(Create)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2%E3%80%81%E8%AF%BB%E5%8F%96-Read"><span class="nav-number">5.2.</span> <span class="nav-text">2、读取(Read)</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#First%E5%92%8CFind"><span class="nav-number">5.2.1.</span> <span class="nav-text">First和Find</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Find%E5%A1%AB%E5%85%85%E7%BB%93%E6%9E%84%E4%BD%93%E5%88%87%E7%89%87%E7%9A%84%E6%96%B9%E6%B3%95"><span class="nav-number">5.2.2.</span> <span class="nav-text">Find填充结构体切片的方法</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%B8%B8%E8%A7%81%E8%AF%BB%E5%8F%96%E6%93%8D%E4%BD%9C"><span class="nav-number">5.2.3.</span> <span class="nav-text">常见读取操作</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%A4%84%E7%90%86%E6%9F%A5%E8%AF%A2%E7%BB%93%E6%9E%9C"><span class="nav-number">5.2.4.</span> <span class="nav-text">处理查询结果</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3%E3%80%81%E6%9B%B4%E6%96%B0-Update"><span class="nav-number">5.3.</span> <span class="nav-text">3、更新(Update)</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Save-%E5%8D%95%E8%AE%B0%E5%BD%95%E6%9B%B4%E6%96%B0"><span class="nav-number">5.3.1.</span> <span class="nav-text">Save:单记录更新</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Update-%E5%8D%95%E5%AD%97%E6%AE%B5%E6%9B%B4%E6%96%B0"><span class="nav-number">5.3.2.</span> <span class="nav-text">Update:单字段更新</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Updates-%E5%A4%9A%E5%AD%97%E6%AE%B5%E6%9B%B4%E6%96%B0"><span class="nav-number">5.3.3.</span> <span class="nav-text">Updates:多字段更新</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E7%BB%93%E6%9E%84%E4%BD%93%E6%9B%B4%E6%96%B0%EF%BC%9A"><span class="nav-number">5.3.4.</span> <span class="nav-text">使用结构体更新：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-map-%E6%9B%B4%E6%96%B0%EF%BC%9A"><span class="nav-number">5.3.5.</span> <span class="nav-text">使用 map 更新：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8Exec%E5%8E%9F%E7%94%9FSQL%E8%AF%AD%E5%8F%A5%E6%9B%B4%E6%96%B0"><span class="nav-number">5.3.6.</span> <span class="nav-text">使用Exec原生SQL语句更新</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4%E3%80%81%E5%88%A0%E9%99%A4-Delete"><span class="nav-number">5.4.</span> <span class="nav-text">4、删除(Delete)</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Delete%E6%96%B9%E6%B3%95"><span class="nav-number">5.4.1.</span> <span class="nav-text">Delete方法</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%BD%AF%E5%88%A0%E9%99%A4"><span class="nav-number">5.4.2.</span> <span class="nav-text">软删除</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">山角函兽</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"model":{"jsonPath":"/live2dw/assets/hibiki.model.json"},"display":{"position":"right","width":150,"height":320},"mobile":{"show":"true#是否在手机端显示"},"log":false});</script></body>
</html>
<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/src/clicklove.js"></script>
